(()=>{"use strict";!function(){const e=setInterval((()=>{document.querySelector('div[aria-label="ここにプロンプトを入力してください"]')&&(clearInterval(e),function(){console.log("[MCP-Content] Target frame confirmed. Initializing main logic...");const e='div[aria-label="ここにプロンプトを入力してください"]',t='button[aria-label="プロンプトを送信"]',n='div[id^="model-response-message-content"]',o="mcp_last_response";let s=null,r=null;function c(){try{const e=document.querySelectorAll(n);return 0===e.length?null:(e[e.length-1].textContent||"").trim()}catch(e){return null}}function i(){s&&s.disconnect();const e=document.body;s=new MutationObserver((()=>{r&&clearTimeout(r),r=window.setTimeout((()=>{console.log("[MCP-Content] --- Observer Fired ---");const e=c();if(e){console.log(`[MCP-Content] Step 1: Extracted text: "${e.substring(0,20)}..."`);try{const t=sessionStorage.getItem(o)||"";console.log(`[MCP-Content] Step 2: Read from sessionStorage. lastSent: "${t.substring(0,20)}..."`),e!==t?(console.log("[MCP-Content] Step 3: ✅ Text is new. Condition (finalText !== lastSent) is TRUE."),console.log("[MCP-Content] Step 4: Attempting to write to sessionStorage..."),sessionStorage.setItem(o,e),console.log("[MCP-Content] Step 5: Write to sessionStorage seems successful."),function(e){const t={status:"success",event:"responseReceived",payload:{text:e}};chrome.runtime.sendMessage(t)}(e)):console.log("[MCP-Content] Step 3: ❌ Text is old (it matches sessionStorage). Condition is FALSE. Ignoring.")}catch(e){console.error("[MCP-Content] ❌ A CRITICAL ERROR occurred while accessing sessionStorage!",e)}}else console.log("[MCP-Content] Observer fired, but no text was extracted.")}),500)})),s.observe(e,{childList:!0,subtree:!0})}function a(e){const t={status:"error",message:e};chrome.runtime.sendMessage(t)}!function(){const e=c();e&&(console.log("[MCP-Content] Priming sessionStorage with initial last response:",e),sessionStorage.setItem(o,e))}(),chrome.runtime.onMessage.addListener((n=>{switch(n.command){case"areYouReady":console.log("[MCP-Content] Received readiness check. Replying with content_ready."),chrome.runtime.sendMessage({type:"content_ready"});break;case"setInput":(o=n.payload.text,new Promise((t=>{try{const n=document.querySelector(e);if(!n)return void t(!1);n.focus(),n.textContent=o;const s=new Event("input",{bubbles:!0});n.dispatchEvent(s),t(!0)}catch(e){t(!1)}}))).then((e=>{e||a("テキスト入力に失敗しました")}));break;case"clickSend":new Promise((e=>{const n=setInterval((()=>{const o=document.querySelector(t);if(o&&!o.disabled){clearInterval(n);try{o.click(),i(),e(!0)}catch(t){e(!1)}}}),100)})).then((e=>{e||a("送信ボタンクリックに失敗しました")}))}var o;return!0})),chrome.runtime.sendMessage({type:"content_ready"})}())}),500)}()})();
//# sourceMappingURL=content.js.map